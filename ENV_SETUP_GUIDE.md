# Windows環境変数設定ガイド

## 概要
このガイドでは、メール送信機能のためのWindows環境変数設定用コマンドファイルの使い方を説明します。

## コマンドファイル一覧

| ファイル名 | 説明 | 管理者権限 |
|-----------|------|-----------|
| `setup_env.cmd` | 環境変数を設定する | 必要 |
| `check_env.cmd` | 環境変数を確認する | 不要 |
| `remove_env.cmd` | 環境変数を削除する | 必要 |

---

## 1. setup_env.cmd - 環境変数の設定

### 実行方法

1. **`setup_env.cmd`を右クリック**
2. **「管理者として実行」を選択**
3. **画面の指示に従って入力**

### 入力項目

```
SMTPホスト (例: smtp.gmail.com): smtp.gmail.com
SMTPポート (例: 587): 587
メールアドレス (例: your-email@gmail.com): your-email@gmail.com
パスワード/アプリパスワード: ****************
送信元メールアドレス (空白でSMTP_USERと同じ): [Enter]
送信元名前 (デフォルト: ダイソウ工業株式会社): [Enter]
```

### 実行例

```cmd
=====================================
メール送信機能 - 環境変数設定
=====================================

このスクリプトはメール送信に必要な環境変数を設定します。

以下の情報を入力してください：

SMTPホスト (例: smtp.gmail.com): smtp.gmail.com
SMTPポート (例: 587): 587

メールアドレス (例: your-email@gmail.com): test@gmail.com
パスワード/アプリパスワード: abcd1234efgh5678

送信元メールアドレス (空白でSMTP_USERと同じ):
送信元名前 (デフォルト: ダイソウ工業株式会社):

=====================================
設定内容の確認
=====================================
SMTP_HOST     : smtp.gmail.com
SMTP_PORT     : 587
SMTP_USER     : test@gmail.com
SMTP_PASSWORD : ********
FROM_EMAIL    : test@gmail.com
FROM_NAME     : ダイソウ工業株式会社
=====================================

この内容で設定しますか？ (Y/N): Y

環境変数を設定中...
[OK] SMTP_HOST を設定しました。
[OK] SMTP_PORT を設定しました。
[OK] SMTP_USER を設定しました。
[OK] SMTP_PASSWORD を設定しました。
[OK] FROM_EMAIL を設定しました。
[OK] FROM_NAME を設定しました。

=====================================
設定完了
=====================================

環境変数の設定が完了しました。

[重要] 設定を反映するには以下を実行してください：
  1. コマンドプロンプトを閉じる
  2. Flaskアプリケーションを再起動する
```

---

## 2. check_env.cmd - 環境変数の確認

### 実行方法

1. **`check_env.cmd`をダブルクリック**
   - または、コマンドプロンプトで `check_env.cmd` を実行

### 実行例

```cmd
=====================================
環境変数の確認
=====================================

[SMTP設定]
  SMTP_HOST     : smtp.gmail.com
  SMTP_PORT     : 587

[認証情報]
  SMTP_USER     : test@gmail.com
  SMTP_PASSWORD : ******** (設定済み)

[送信元情報]
  FROM_EMAIL    : test@gmail.com
  FROM_NAME     : ダイソウ工業株式会社

=====================================
[OK] すべての環境変数が設定されています。
=====================================
```

### 未設定の場合

```cmd
=====================================
環境変数の確認
=====================================

[SMTP設定]
  SMTP_HOST     : [未設定]
  SMTP_PORT     : [未設定]

[認証情報]
  SMTP_USER     : [未設定]
  SMTP_PASSWORD : [未設定]

[送信元情報]
  FROM_EMAIL    : [未設定]
  FROM_NAME     : [未設定]

=====================================
[警告] 一部の環境変数が未設定です。

setup_env.cmd を管理者権限で実行して設定してください。
=====================================
```

---

## 3. remove_env.cmd - 環境変数の削除

### 実行方法

1. **`remove_env.cmd`を右クリック**
2. **「管理者として実行」を選択**
3. **確認プロンプトで `Y` を入力**

### 実行例

```cmd
=====================================
メール送信機能 - 環境変数削除
=====================================

このスクリプトはメール送信に関する環境変数を削除します。

本当に削除しますか？ (Y/N): Y

環境変数を削除中...
[OK] SMTP_HOST を削除しました。
[OK] SMTP_PORT を削除しました。
[OK] SMTP_USER を削除しました。
[OK] SMTP_PASSWORD を削除しました。
[OK] FROM_EMAIL を削除しました。
[OK] FROM_NAME を削除しました。

=====================================
削除完了
=====================================

環境変数の削除が完了しました。

[重要] 設定を反映するには以下を実行してください：
  1. コマンドプロンプトを閉じる
  2. Flaskアプリケーションを再起動する
```

---

## トラブルシューティング

### エラー: 管理者権限が必要です

**問題**:
```
[エラー] このスクリプトは管理者権限で実行する必要があります。
```

**解決方法**:
1. コマンドファイルを右クリック
2. 「管理者として実行」を選択

### 設定が反映されない

**問題**: 環境変数を設定したのに、アプリケーションで認識されない

**解決方法**:
1. コマンドプロンプトを再起動
2. Flaskアプリケーションを再起動
3. `check_env.cmd`で設定を確認

### パスワードが正しいのにメール送信できない

**問題**:
```
メール送信に失敗しました: Authentication failed
```

**解決方法**:
- Gmailの場合: アプリパスワードを使用しているか確認
- 2段階認証が有効になっているか確認
- パスワードに特殊文字が含まれている場合、引用符で囲む

---

## 環境変数の優先順位

アプリケーションは以下の優先順位で設定を読み込みます：

1. **Windows環境変数**（最優先）
2. `.env`ファイル
3. デフォルト値

つまり、Windows環境変数と`.env`ファイルの両方に設定がある場合、Windows環境変数が優先されます。

---

## セキュリティに関する注意

### 環境変数の確認

現在設定されている環境変数を確認するには：

```cmd
REM 特定の環境変数を確認
echo %SMTP_USER%

REM すべての環境変数を確認
set
```

### 環境変数の保護

- 環境変数はシステム全体で利用可能です
- 同じPCを複数人で使用する場合は注意してください
- 機密情報（パスワード）が含まれているため、画面共有時は注意してください

### バックアップ

設定をバックアップする場合：

```cmd
REM 現在の環境変数をテキストファイルに保存
echo SMTP_HOST=%SMTP_HOST% > email_config_backup.txt
echo SMTP_PORT=%SMTP_PORT% >> email_config_backup.txt
echo SMTP_USER=%SMTP_USER% >> email_config_backup.txt
echo FROM_EMAIL=%FROM_EMAIL% >> email_config_backup.txt
echo FROM_NAME=%FROM_NAME% >> email_config_backup.txt
```

**注意**: パスワードはバックアップしないでください！

---

## 関連ドキュメント

- [MAIL_SETUP.md](MAIL_SETUP.md) - メール送信機能の詳細設定方法
- [.env.example](.env.example) - 環境変数のテンプレート
